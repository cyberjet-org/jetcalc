<div class="wysiwyg-toolbar btn-toolbar toolH" data-bind='with:MPeriods'>
    <!-- ko template:'tb_simple_loader' --><!-- /ko -->
    <!-- ko if:$data.IsModelEdit() -->
    	<!-- ko template:'model_edit_buttons' --><!-- /ko -->
    	<!-- ko template:'model_edit_search' --><!-- /ko -->
    <!-- /ko -->
    <!-- ko if:Mode()=='PeriodEdit' -->
        <div class="btn-group">
            <a class="btn btn-sm btn-white btn-primary dropdown-toggle" data-toggle="dropdown">
              <span data-bind="text: $data.Year()"></span>
              <i class="fa fa-angle-down icon-on-right fa-light"></i>
            </a>
            <ul class="dropdown-menu dropdown-light dropdown-caret">
                <!-- ko foreach:Catalogue.GetAll('year') -->
                <li>
                  <a data-bind="click: $parent.UpdateYear.bind(null,$data.id)">
                    <span data-bind="text: $data.name"></span>
                  </a>
                </li>
               <!-- /ko -->
           </ul>
       </div>
       <!-- ko template:'save_changes' --><!-- /ko -->
    <!-- /ko -->
    <!-- ko if:Mode()=='PeriodMap' -->
        <!-- ko template:'model_connect_buttons' --><!-- /ko -->
    <!-- /ko -->
    <!-- ko if:Mode()=='PeriodAutoFill' -->
        <!-- ko template:'model_connect_buttons' --><!-- /ko -->
    <!-- /ko -->
</div>

<div class="row adminbody" data-bind="with:MPeriods">
	<div  >
		<div class='row'><!-- ko template: 'inline_error' --><!-- /ko --></div>
		<!-- ko if:$data.IsModelEdit() -->
			<!-- ko template:'model_edit' --><!-- /ko -->
		<!-- /ko -->
        <!-- ko if:Mode()=='PeriodAutoFill' -->
            <!-- ko template:'connect_form' --><!-- /ko -->
        <!-- /ko -->

        <!-- ko if:Mode()=='PeriodMap' -->
            <!-- ko template:'connect_form' --><!-- /ko -->
        <!-- /ko -->
        <!-- ko if:Mode()=='PeriodEdit' -->
            <div class='handsonContainer'>
                <div class="handsontable single"  data-bind="handson-table:MPeriods.PeriodEditConfig,handson-table-result:MPeriods.PeriodEditResult"></div>  
            </div>
        <!-- /ko -->
        <!-- ko if:false -->
        <div class='row' data-bind='with:$data.Table'>
            <!-- ko foreach: _.keys($data) -->
            <div class='widget-box transparent'>
                <div class="widget-header widget-header-flat"><h4 class="widget-title lighter">
                    <!-- ko template:{name:'catalogue',data:{model:'periodgrp',id:$data}} --><!-- /ko -->
                </h4></div>
                <div class="widget-body" data-bind="with:$parent[$data]">
                    <table class="table openperiods table-striped table-bordered table-hover dataTable no-footer" style='width: initial;'>
                        <thead><tr>
                            <th style='width:400px'>Группа документов</th>
                            <!-- ko foreach:_.keys($data) -->
                                <th>
                                <!-- ko template:{name:'catalogue',data:{model:'period',id:$data}} --><!-- /ko -->
                                (<span data-bind='text:$data'></span>)  
                                </th>
                            <!-- /ko -->
                        </tr></thead>
                        <tbody data-bind='foreach:MPeriods.Roles()'>
                            <tr>
                                <td >
                                    <!-- ko template:{name:'catalogue_withcode',data:{model:'role',id:$data}} --><!-- /ko -->
                                </td>
                                <!-- ko foreach:_.keys(MPeriods.Table()[$parents[1]]) -->
                                    <td  data-bind='css:$parents[1][$data][$parent]? "opened":"closed" '>
                                        <label class="middle">
                                            <input class="ace" type="checkbox" data-bind='checked:$parents[1][$data][$parent]'/>
                                            <span class="lbl"></span>
                                        </label>
                                    </td>
                                <!-- /ko -->
                            </tr>
                        </tbody>
                    </table>                    
                </div>
            </div>
            <!-- /ko -->
        </div>         
        <!-- /ko -->
	</div>
</div>

<div class="bottomPannel" data-bind="with:MPeriods">
	<ul class="toolPanel nav nav-tabs background-blue">
    	<!-- ko template:{name:'tb_mode_switch_li',data:{icon:'fa-calendar',title:'Периоды',mode:'Periods'}} --><!-- /ko -->    	
    	<!-- ko template:{name:'tb_mode_switch_li',data:{icon:'fa-folder-open-o',title:'Группы Периодов',mode:'PeriodGrps'}} --><!-- /ko -->    	
    	<!-- ko template:{name:'tb_mode_switch_li',data:{icon:'fa-calendar-check-o',title:'Отк.Периоды',mode:'PeriodEdit'}} --><!-- /ko -->    	
        <!-- ko template:{name:'tb_mode_switch_li',data:{icon:'fa-calendar-plus-o',title:'Доп.Периоды',mode:'PeriodMap'}} --><!-- /ko -->       
        <!-- ko template:{name:'tb_mode_switch_li',data:{icon:'fa-calendar-times-o',title:'Перевод Периодов',mode:'PeriodRedirect'}} --><!-- /ko -->       
        <!-- ko template:{name:'tb_mode_switch_li',data:{icon:'fa-calendar-minus-o',title:'АвтоПрокачка.Периоды',mode:'PeriodAutoFill'}} --><!-- /ko -->        
    	<!-- ko template:{name:'tb_mode_switch_li',data:{icon:'fa-calendar-o',title:'Календарь',mode:'Calendar'}} --><!-- /ko -->    	
	</ul>
</div>
