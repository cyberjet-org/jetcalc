<script id="catalogue" type="text/html">
    <span data-bind='attr:{"data-catalogue":$data.model+"_"+$data.id},text:Catalogue.Get($data.model,$data.id)'></span>
</script>

<script id="catalogue_withcode" type="text/html">
    <span class='label label-info' data-bind='text:$data.id'></span>
    <span data-bind='attr:{"data-catalogue":$data.model+"_"+$data.id},text:Catalogue.Get($data.model,$data.id)'></span>
</script>

<div id="select_table_modal" class="modal fade" data-bind="with:  ModelChooser.ModelName">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" style='margin-bottom: 30px;'>
                <div data-bind="if: EditorRegistrator.CurrentEditor() === 'select_table'">
                    <div data-bind="with: EditorRegistrator.EditRow" style='margin-bottom: 20px;'>
                        <div class='select-table-header' style='height:40px;'>
                            <div class="nav-search">
                                <div class="form-search">
                                    <span class="input-icon">
                                        <input type="text" placeholder="Поиск ..." class="nav-search-input" data-bind="value:ModelChooser.SearchStr,valueUpdate:'afterkeydown'" autocomplete="off">
                                        <i class="ace-icon fa fa-search nav-search-icon"></i>
                                    </span>
                                </div>
                            </div>
                            <div class="nav-search" style="right:0px;left:initial;" data-bind='Permit:{Type:"Model",Id:ModelChooser.ModelName()}'>
                                <button class="btn btn-white btn-info no-border" data-bind='click:ModelTableEdit.AddRefModel.bind(null,null,ModelChooser.SearchStr,ModelChooser.ModelName())'>
                                    <i class="ace-icon fa fa-plus"></i><span>Добавить</span>
                                </button>
                            </div>
                        </div>
                        <div data-bind='with:ModelChooser.SearchResults'>
                            <table class="table  table-bordered table-hover dataTable  smallTable">
                                <thead>
                                    <tr class='subheader' data-bind='foreach:ModelChooser.TableFields()'>
                                        <th data-bind='model:ModelChooser.ModelName,lang:$data'></th>
                                    </tr>
                                </thead>
                                <tbody data-bind='foreach:$data'>
                                    <tr class='clickable permit' data-bind='click:ModelChooser.Choosed,css:ModelChooser.ChoosedCss($data)'>
                                        <!-- ko foreach:ModelChooser.TableFields() -->
                                        <td class='tdnowrap' data-bind='text:$parent[$data]'></td>
                                        <!-- /ko -->
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- ko template:'editor_buttons' -->
                    <!-- /ko -->
                </div>
            </div>
        </div>
    </div>
</div>

<div id="select_table_modal_add" class="modal fade" data-bind="with:  ModelChooser.ModelName">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" style='margin-bottom: 30px;'>
                <!-- ko with:ModelChooser -->
                <!-- ko template: 'inline_error' -->
                <!-- /ko -->
                <!-- /ko -->
                <div data-bind='with:ModelChooser.NewModel'>
                    <!-- ko template:{
                        name:'small_form_with_header',
                        data:{
                            Name:Tr($parent)+" (добавление)",
                            Fields:ModelChooser.TableFields(),
                            Model:ModelChooser.NewModel
                        }
                    } -->
                    <!-- /ko -->
                </div>
                <div class='modalbuttons' data-bind='with:ModelChooser'>
                    <button class="btn btn-white btn-info" data-bind='click:CancelAdd'>
                        <i class="ace-icon fa fa-times red2"></i>
                        <span data-bind='lang:"close"'></span>
                    </button>
                    <button class="btn btn-white btn-success" data-bind='click:SaveNew'>
                        <i class="ace-icon fa fa-floppy-o bigger-120 green"></i>
                        <span data-bind='lang:"save"'></span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Model Table Edit -->

<script id="model_edit_add" type="text/html">
    <a class='btn btn-sm btn-success btn-white ' data-bind="title:'Новый',click:ModelTableEdit.Add,css:{disabled:ModelTableEdit.NoAccess()}" id='modeladd'>
        <i class="ace-icon fa fa-file-o"></i>
    </a>
</script>

<script id="model_edit_delete" type="text/html">
    <a class='btn btn-sm btn-warning btn-white ' data-bind="title:'Удалить',click:ModelTableEdit.Delete,css:{disabled:ModelTableEdit.NoAccess() || !ModelTableEdit.LoadedModel()}">
        <i class="ace-icon fa fa-trash-o"></i>
    </a>
</script>

<script id="model_edit_save" type="text/html">
    <a class='btn btn-sm btn-primary btn-white ' data-bind="title:'Сохранить',click:ModelTableEdit.Save,css:{disabled:ModelTableEdit.NoAccess() || !ModelTableEdit.LoadedModel()}" id='modelsave'>
        <i class="ace-icon fa fa-save"></i>
    </a>
</script>

<script id="model_edit_settings" type="text/html">
    <a class='btn btn-sm btn-primary btn-white ' data-bind="title:'Настройки',click:ModelTableEdit.Settings,css:{disabled:ModelTableEdit.NoAccess()}" id='modelsettings'>
        <i class="ace-icon fa fa-cog"></i>
    </a>
</script>

<script id="model_edit_buttons" type="text/html">
    <div class="btn-group">
        <!-- ko template:'model_edit_add' -->
        <!-- /ko -->
        <!-- ko template:'model_edit_save' -->
        <!-- /ko -->
        <!-- ko template:'model_edit_delete' -->
        <!-- /ko -->
        <!-- ko template:'model_edit_settings' -->
        <!-- /ko -->
    </div>
</script>

<script id="model_edit_search" type="text/html">
    <div class="btn-group">
        <span class="input-icon">
            <input type="text" placeholder="Поиск ..." class="nav-search-input" autocomplete="off" data-bind="value:ModelTableEdit.Search,valueUpdate:'afterkeydown'" >
            <i class="ace-icon fa fa-search nav-search-icon " ></i>
        </span>
    </div>
</script>

<script id="read_field" type="text/html">
    <!-- ko if:$parent.Types[$data].Type=='Boolean' -->
        <label>
            <input name="form-field-checkbox" class="ace ace-checkbox-2" type="checkbox" readonly="true" data-bind='checked:$parent[$data]' />
            <span class="lbl"></span>
        </label>
    <!-- /ko -->
    <!-- ko ifnot:$parent.Types[$data].Type=='Boolean' -->
        <span data-bind='text:$parent[$data]'> </span>
    <!-- /ko -->
</script>


<script id="model_edit" type="text/html">
    <div class="row" data-bind='with:ModelTableEdit'>
        <!-- ko ifnot:$data.IsOverrideList() -->
        <div class='col-xs-6  scrollable_col' style="margin-top:10px;" data-bind='with:$data.List, event: {scroll: ModelTableEdit.scrolled}'>
            <table class="table table-striped table-bordered table-hover dataTable no-footer small-paddings">
                <thead>
                    <tr class='subheader' data-bind='foreach:ModelTableEdit.TableFields()'>
                        <td data-bind='model:ModelTableEdit.ModelName(),lang:$data'></td>
                    </tr>
                </thead>
                <!-- ko ifnot:$data.length -->
                <tbody>
                    <tr>
                        <td data-bind="attr:{colspan:ModelTableEdit.TableFields().length}" class='tdnowrap'>Записей - нет</td>
                    </tr>
                </tbody>
                <!-- /ko -->
                <tbody data-bind='foreach:$data'>
                    <tr class='clickable permit' data-bind='click:ModelTableEdit.SetChoosed,css:{selected:ModelTableEdit.IsChoosed($data)},foreach:ModelTableEdit.TableFields()'>
                        <td class='tdnowrap'>
                            <!-- ko template:'read_field' -->
                            <!-- /ko -->
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <!-- /ko -->
        <!-- ko if: ModelTableEdit.IsOverrideList() -->
        <div class='col-xs-6  scrollable_col' style="margin-top:10px;">
            <!-- ko template: 'override_model_edit_list_'+$data.ModelName() -->
            <!-- /ko -->
        </div>
        <!-- /ko -->

        <div class='col-xs-6 scrollable_col' style="margin-top:10px;" data-bind='with:LoadedModel'>
            <!-- ko ifnot:$data._id -->
                <h3 class="row header smaller lighter blue no-margin-top">Добавление</h3>
                <!-- ko template:{
                    name:'small_form_with_header',
                    data:{
                        Name:'',
                        Fields:ModelTableEdit.EditFields(),
                        Model:ModelTableEdit.LoadedModel
                    }
                } -->
                <!-- /ko -->
            <!-- /ko -->
            <!-- ko if:$data._id -->
                <h3 class="row header smaller lighter blue no-margin-top">Редактирование</h3>
                <!-- ko template:{
                    name:'small_form_with_header',
                    data:{
                        Name:'',
                        Fields:ModelTableEdit.ForceEditFields(),
                        Model:ModelTableEdit.LoadedModel
                    }
                } -->
                <!-- /ko -->
            <!-- /ko -->
            <!-- ko if:ModelTableEdit.EditLinks().length -->
                <!-- ko foreach:ModelTableEdit.EditLinks() -->
                    <!-- ko template:{
                        name:'edit_links',
                        data:{
                            Name:Tr("Link_"+$data),
                            MainModel:ModelTableEdit.LoadedModel().ModelName,
                            LinkModel:$data,
                            Model:ModelTableEdit.LoadedModel
                        }
                    } -->
                    <!-- /ko -->
                <!-- /ko -->
            <!-- /ko -->
            <!-- ko if:ModelTableEdit.IsExtendEditor() -->
                <!-- ko template:{
                    name:'extend_model_edit_'+ModelTableEdit.ModelName()
                } -->
                <!-- /ko -->
            <!-- /ko -->
        </div>
    </div>
</script>

<script id="model_settings_form" type="text/html">
    <div>
        <!-- ko if:$data.Name && $data.Name.length -->
        <h3 class="row header smaller lighter blue" data-bind='text:$data.Name'></h3>
        <!-- /ko -->
        <!-- ko with:$data.Model -->
        <div class="profile-user-info profile-user-info-striped" style='margin-bottom: 3px;'>
            <!-- ko foreach: $parent.Fields  -->
            <div class="profile-info-row">
                <div class="profile-info-name" data-bind="model:$parent.ModelName,lang:$data"></div>
                <div class="profile-info-value">
                    <div class="checkbox">
                        <input class="ace ace-checkbox-2" type="checkbox" data-bind="checked: $parents[1].CheckList()[$data]">
                        <span class="lbl"></span>
                    </div>
                </div>
            </div>
            <!-- /ko -->
        </div>
        <!-- /ko -->
    </div>
</script>


<div class="modal fade" tabindex="-1" role="dialog" id="cascadeAddModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content" data-bind="with: ModelTableEdit">
            <div class="modal-body">
                <!-- ko if: refStack().length -->
                <div class="page-header" data-bind="with: refStack()">
                    <h1>
                        <span data-bind="lang: _.first($data).fieldName, click: ModelTableEdit.goToStackPos.bind(null,0)"></span>
                        <small data-bind="foreach: _.tail($data)" class='clickable'>
                            <i class="ace-icon fa fa-angle-double-right"></i>
                            <span data-bind="lang: $data.fieldName, click: ModelTableEdit.goToStackPos.bind(null,$index()+1)"></span>
                        </small>
                    </h1>
                </div>

                <div data-bind="with: _.last(refStack()).model">
                    <!-- ko template:{
                        name:'small_form_with_header',
                        data:{
                            Name:'',
                            Fields:$data.EditFields,
                            Model:$data
                        }
                    } -->
                    <!-- /ko -->
                </div>
                <!-- /ko -->

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-white" data-dismiss="modal" data-bind="click: hideAddModal">Отменить</button>
                <button type="button" class="btn btn-primary btn-white" data-bind="click: saveRefElement">
                    <i class='fa fa-icon fa-floppy-o'></i>
                    Сохранить
                </button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<!-- /.modal -->


<div class="modal fade" tabindex="-1" role="dialog" id="delete_dependance">
    <div class="modal-dialog" role="document">
        <div class="modal-content" data-bind="with: ModelTableEdit">
            <div class="modal-body">
                <div class="page-header">
                    <h1 data-bind='lang:"dependaction"'></h1>
                </div>
                <div data-bind="with: $data.Dependable">
                    <table class="table  table-bordered table-hover dataTable  smallTable">
                        <tbody data-bind='foreach:_.keys($data)'>
                            <tr>
                                <td data-bind='lang:$data'></td>
                                <td data-bind='html:$parent[$data].join("<br/>")'></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default btn-white" data-dismiss="modal" data-bind="lang:'forcedelete',click:$data.ForceDelete"></button>
            </div>
        </div>
    </div>
</div>

<div id="catalogue_settings_modal" class="modal fade">
    <div class="modal-dialog" data-bind="with:ModelTableEdit">
        <div class="modal-content">
            <div class="modal-body">
                <table style="width:100%;">
                    <tr>
                        <td style="width:30%;vertical-align:top">
                            <!-- ko if: ModelTableEdit.TableFieldsModel -->
                                <!-- ko template:{
                                    name:'model_settings_form',
				                    data:{
                                        Name:'Таблица',
                                        Fields:ModelTableEdit.TableFieldsModel().EditFields,
                                        Model:ModelTableEdit.TableFieldsModel,
                                        CheckList:ModelTableEdit.TableFieldsCheckList
                                    }
			                     } -->
                                <!-- /ko -->
                            <!-- /ko -->
                        </td>
                        <td style="width:5%"></td>
                        <td style="width:30%;vertical-align:top">
                            <!-- ko if: ModelTableEdit.TableFieldsModel -->
                                <!-- ko template:{
                                    name:'model_settings_form',
				                    data:{
                                        Name:'Редактирование',
                                        Fields:ModelTableEdit.TableFieldsModel().EditFields,
                                        Model:ModelTableEdit.TableFieldsModel,
                                        CheckList:ModelTableEdit.ForceEditFieldsCheckList
                                    }
			                     } -->
                                <!-- /ko -->
                            <!-- /ko -->
                        </td>
                        <td style="width:5%"></td>
                        <td style="width:30%;vertical-align:top">
                            <!-- ko if: ModelTableEdit.TableFieldsModel -->
                                <!-- ko template:{
                                    name:'model_settings_form',
				                    data:{
                                        Name:'Ссылки',
                                        Fields:_.keys(ModelTableEdit.LinkFieldsCheckList()),
                                        Model:ModelTableEdit.TableFieldsModel,
                                        CheckList:ModelTableEdit.LinkFieldsCheckList
                                    }
			                     } -->
                                <!-- /ko -->
                            <!-- /ko -->
                        </td>
                    </tr>
                </table>
                <br>
                <button class="btn btn-blue btn-sm" data-bind="click:ModelTableEdit.SaveSettings">
					<i class="ace-icon fa fa-floppy-o"></i>
                </button>
            </div>
        </div>
    </div>
</div>
