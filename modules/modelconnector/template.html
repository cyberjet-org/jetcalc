<script id="model_connect_buttons" type="text/html">
    <div class="btn-group">
        <!-- ko template:'model_connect_save' -->
        <!-- /ko -->
    </div>
    <div class="btn-group">
        <!-- ko template:'model_connect_settings' -->
        <!-- /ko -->
    </div>
</script>

<script id="model_connect_save" type="text/html">
    <a class='btn btn-sm btn-primary btn-white ' data-bind="title:'Сохранить',click:MModelConnector.SaveChanges" id='modelsave'>
        <i class="ace-icon fa fa-save"></i>
    </a>
</script>

<script id="model_connect_settings" type="text/html">
    <a class='btn btn-sm btn-primary btn-white ' data-bind="title:'Настройки',click:MModelConnector.Settings, css:{disabled:ModelTableEdit.NoAccess()}" id='modelsettings'>
        <i class="ace-icon fa fa-cog"></i>
    </a>
</script>

<script id="connect_editor_text" type="text/html">
    <input type="text" class='small_input' data-bind='value:$data.Value'></input>
</script>

<script id="connect_editor_number" type="text/html">
    <input type="number" class='small_input' data-bind='value:$data.Value'></input>
</script>

<script id="connect_editor_combobox" type="text/html">
    <combobox-editor params="field:$data.Value,fieldname:$data.Name,refmodel:$data.TargetModel,mainmodel:$data.SourceModel">
    </combobox-editor>
</script>

<script id="connect_editor_check" type="text/html">
    <input type="checkbox" class='ace ace-checkbox-2' data-bind='checked:$data.Value'>
    <span class="lbl"></span>
    </input>
</script>

<script id="connect_editor" type="text/html">
    <!-- ko if:$data.Editor == 'text' -->
    <!-- ko template:{
        name:'connect_editor_text',
		data:{
            Value: $data.Value,
        }
    } -->
    <!-- /ko -->
    <!-- /ko -->
    <!-- ko if:$data.Editor == 'number' -->
    <!-- ko template:{
        name:'connect_editor_number',
		data:{
            Value: $data.Value,
        }
    } -->
    <!-- /ko -->
    <!-- /ko -->
    <!-- ko if:$data.Editor == 'check' -->
    <!-- ko template:{
        name:'connect_editor_check',
		data:{
            Value: $data.Value,
        }
    } -->
    <!-- /ko -->
    <!-- /ko -->
    <!-- ko if:$data.Editor == 'combobox' -->
    <!-- ko template:{
        name:'connect_editor_combobox',
		data:{
            Value: $data.Value,
            Name: $data.Name,
            TargetModel: $data.TargetModel,
            SourceModel: $data.SourceModel,
        }
    } -->
    <!-- /ko -->
    <!-- /ko -->
</script>

<script id="connect_form" type="text/html">
    <div class='row'>
        <table class="table table-striped table-bordered table-hover dataTable no-footer small-paddings periodsMapTable">
            <tbody data-bind='foreach:MModelConnector.MainModels'>
                <tr data-bind='css:{active:MModelConnector.IsCurrentEditModel($data)}'>
                    <td>
                        <span class="action-buttons gray-icons">
                                <a  data-bind="title:Lang.Tr('edit'), click:MModelConnector.SetEditModel">
                                    <i class="ace-icon fa fa-pencil"></i>
                                </a>
                        </span>
                    </td>
                    <td data-bind='text:$data[MModelConnector.code_source_model()]'></td>
                    <td data-bind='text:$data[MModelConnector.name_source_model()]'></td>
                    <td>
                        <table class="table openperiods table-striped table-bordered table-hover dataTable no-footer" style='min-width: 600px;'>
                            <thead data-bind='if:MModelConnector.LinkModels()[$data[MModelConnector.code_source_model()]()]().length'>
                                <tr>
                                    <!-- ko foreach:MModelConnector.model_edit_fields -->
                                    <td data-bind="text:$data.name"></td>
                                    <!-- /ko -->
                                    <!-- ko if:MModelConnector.IsCurrentEditModel($data) -->
                                    <td></td>
                                    <!-- /ko -->
                                </tr>
                            </thead>
                            <tbody>
                                <!-- ko if:MModelConnector.IsCurrentEditModel($data) -->
                                <!-- ko foreach:MModelConnector.LinkModels()[$data[MModelConnector.code_source_model()]()] -->
                                <tr>
                                    <!-- ko foreach:MModelConnector.model_edit_fields -->
                                    <td data-bind="attr:{class:$data.class}">
                                        <!-- ko template:{
                                            name:'connect_editor',
				                            data:{
                                                Editor: $data.editor,
                                                Value: $parent[$data.field_name],
                                                Name: $data.name,
                                                SourceModel: MModelConnector.source_model(),
                                                TargetModel: $data.target_model
                                            }
			                             } -->
                                        <!-- /ko -->
                                    </td>
                                    <!-- /ko -->
                                    <td class='middle_check'>
                                        <a data-bind="click:MModelConnector.RemoveLinkModel.bind($data,$parent[MModelConnector.code_source_model()]())">
                                            <i class="fa fa-icon fa-times"></i>
                                        </a>
                                    </td>
                                </tr>
                                <!-- /ko -->
                                <tr>
                                    <td colspan=5>
                                        <a class="addLinkModel" data-bind="click:function(){MModelConnector.AddLinkModel($data[MModelConnector.code_source_model()]())}">Добавить</a>
                                    </td>
                                </tr>
                                <!-- /ko -->
                                <!-- ko ifnot:MModelConnector.IsCurrentEditModel($data) -->
                                <!-- ko foreach:MModelConnector.LinkModels()[$data[MModelConnector.code_source_model()]()] -->
                                <tr>
                                    <!-- ko foreach:MModelConnector.model_edit_fields -->
                                    <td data-bind="attr:{class:$data.class}, html:$data.wrapper($parent[$data.field_name])"></td>
                                    <!-- /ko -->
                                </tr>
                                <!-- /ko -->
                                <!-- /ko -->
                            </tbody>
                        </table>
                    </td>
                </tr>
            </tbody>
        </table>
        <button class="btn btn-white btn-sm btn-info" data-bind="click:MModelConnector.AddMainModel" style="margin-top:-85px; margin-left:10px;">
	       <i class="ace-icon fa fa-plus"></i> Добавить
        </button>
    </div>
</script>


<div id="add_main_model_modal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body" data-bind="if:MModelConnector.empty_target_model_loaded">
                <!-- ko template:{
					name:'small_form_with_header',
					data:{
                        Name:'',
                        Fields: [MModelConnector.code_source_model()],
                        Model: MModelConnector.empty_target_model
                    }
			     } -->
                <!-- /ko -->
                <button class="btn btn-white btn-sm btn-info" data-bind="click:MModelConnector._AddMainModel" style="margin-top:10px; margin-left:10px;">
	                <i class="ace-icon fa fa-plus"></i> Добавить
                </button>
            </div>
        </div>
    </div>
</div>

<div id="connector_settings_modal" class="modal fade">
    <div class="modal-dialog" data-bind="with:ModelTableEdit" style="max-width: 800px;max-height: 600px;">
        <div class="modal-content">
            <h3 class='row header smaller lighter blue' style="padding-left: 5px;">Настройка отображения</h3>
            <div class="modal-body">
                <div class='row'>
                    <div>
                        <div>
                            <ul class="nav nav-tabs">
                                <li class="active"><a data-toggle="tab" href="#ShowFields" aria-expanded="true"><i class="pink ace-icon fa fa-table bigger-110"></i>Поля таблицы</a></li>
                            </ul>
                            <div class="tab-content  padding-12" style='max-height: 500px;overflow-y: scroll;'>
                                <div id="ShowFields" class="tab-pane active">
                                    <!-- ko template:{
                                            name:'model_settings_form',
                                            data:{
                                                AllValues:ModelTableEdit.AllEditFields,
                                                Value:ModelTableEdit.TableFieldsCheck
                                            }
                                         } -->
                                    <!-- /ko -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="btn btn-white btn-sm btn-info" data-bind="click:MModelConnector.SaveSettings" style='margin-top:10px;'>
					<i class="ace-icon fa fa-floppy-o"></i> Сохранить
                </button>
            </div>
        </div>
    </div>
</div>
